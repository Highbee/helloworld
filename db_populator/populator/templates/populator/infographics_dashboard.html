<!DOCTYPE html>
<html>
<head>
    <title>Infographics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Infographics Dashboard</h1>

    <h2>Daily Production</h2>
    <canvas id="dailyProductionChart" width="400" height="200"></canvas>

    <h2>Weekly Production</h2>
    <canvas id="weeklyProductionChart" width="400" height="200"></canvas>

    <h2>Monthly Production</h2>
    <canvas id="monthlyProductionChart" width="400" height="200"></canvas>

    <script>
        // Helper function to generate random colors for the charts
        function getRandomColor() {
            var letters = '0123456789ABCDEF'.split('');
            var color = '#';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        // Daily Production Chart
        fetch('/api/daily_production/')
            .then(response => response.json())
            .then(data => {
                const products = [...new Set(data.map(item => item.product__product_name))];
                const labels = [...new Set(data.map(item => item.day))].sort();

                const datasets = products.map(product => {
                    return {
                        label: product,
                        data: labels.map(label => {
                            const item = data.find(d => d.day === label && d.product__product_name === product);
                            return item ? item.total_produced : 0;
                        }),
                        backgroundColor: getRandomColor(),
                    };
                });

                new Chart(document.getElementById('dailyProductionChart'), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: datasets
                    },
                    options: {
                        scales: {
                            x: { stacked: true },
                            y: { stacked: true }
                        }
                    }
                });
            });

        // Weekly Production Chart
        fetch('/api/weekly_production/')
            .then(response => response.json())
            .then(data => {
                const products = [...new Set(data.map(item => item.product__product_name))];
                const labels = [...new Set(data.map(item => item.week))].sort();

                const datasets = products.map(product => {
                    return {
                        label: product,
                        data: labels.map(label => {
                            const item = data.find(d => d.week === label && d.product__product_name === product);
                            return item ? item.total_produced : 0;
                        }),
                        borderColor: getRandomColor(),
                        fill: false,
                    };
                });

                new Chart(document.getElementById('weeklyProductionChart'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: datasets
                    }
                });
            });

        // Monthly Production Chart
        fetch('/api/monthly_production/')
            .then(response => response.json())
            .then(data => {
                const products = [...new Set(data.map(item => item.product__product_name))];
                const labels = [...new Set(data.map(item => item.month))].sort();

                const datasets = products.map(product => {
                    return {
                        label: product,
                        data: labels.map(label => {
                            const item = data.find(d => d.month === label && d.product__product_name === product);
                            return item ? item.total_produced : 0;
                        }),
                        borderColor: getRandomColor(),
                        fill: false,
                    };
                });

                new Chart(document.getElementById('monthlyProductionChart'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: datasets
                    }
                });
            });
    </script>
</body>
</html>
